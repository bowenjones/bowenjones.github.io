---
title: "Local Lion"
author: "Bowen Jones"
date: '`r format(Sys.time(), "%b %d, %Y")`'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA)
library(tidyverse)
library(lubridate)
```

# Introduction

Here it is! My first real-world experience with data analysis. Up to this point, everything I've done regarding data analysis has been in a guided, educational context. My previous experience has been helpful in providing me with an outline of how to proceed, but in order to fully understand the process I knew I needed true practice. So I spoke with my employer -- the owner of Local Lion, a coffee shop where I've worked since 2013 -- about gaining access to the shop's sales records with the goal of building a model to predict the number of donuts the shop needs to make on a daily basis (to minimize loss). He granted me access to all the sales records since the shop opened in 2012! 

Let's dive in!

When I initially surveyed the data, I found that it was saved in annual sales reports. I filtered the reports to only grab the sales relevant to our yeast donuts and found that each file needed to be transposed before proceeding in `R`. I transposed each file in excel and combined them into one `.csv` so I wouldn't have to repeat the read-in code for each file.
```{r read in data, message = FALSE}
donuts <- read.csv("./tidydonuts.csv")
glimpse(donuts)
```

Ah, the .csv file imported each variable as a factor. Let me reclassify the data.
```{r}
donuts$Date <- as.Date(donuts$Date, format = "%m/%d/%Y")
donuts$Dozen <- as.numeric(sub('\\$','',as.character(donuts$Dozen)))
donuts$Single <- as.numeric(sub('\\$','',as.character(donuts$Single)))
donuts$HalfDozen <- as.numeric(sub('\\$','',as.character(donuts$HalfDozen)))
glimpse(donuts)
```

Now, as you can see, we have 3 menu item relevant to yeast donuts: `Single`, `Dozen` and `HalfDozen`. These each report the total *sales* regarding each menu item. I'm mainly interested in the *total number* of donuts sold daily, so let's create a variable that reports that.

```{r}
donuts <- donuts %>% 
  mutate(Daily = as.integer(((Dozen/14.75)*12) + (Single/1.64) + ((HalfDozen/8.2)*6)))
glimpse(donuts)
```

What's our high score??
```{r, echo = FALSE}
donuts %>% 
filter(Daily == max(Daily))
```
Wow, almost 1,000 donuts in one day! Guess what June 1st is...National Donut Day.  
What were the other highest values?  
```{r, echo = FALSE}
donuts %>% 
  arrange(desc(Daily)) %>% 
  head()
```


I just gotta know...what's the total number of yeast donuts we've sold??
```{r, echo = FALSE}
donuts %>% 
  summarize("Total Sold" = sum(Daily),
            "Total Sales" = sum(Dozen) + sum(Single) + sum(HalfDozen))
```
Wow! That value doesn't account for the 5 dozen we send daily to Appalachian State University (or our lax data entry), so the real figure's somewhat higher.

Time for some ~data viz~  
```{r, echo = FALSE}
donuts %>%
  ggplot(aes(Date, Daily)) +
  geom_point()
```
  
The horizontal line may initially strike you as peculiar, but we're closed on Sundays.
There's also a marked increase in sales in mid-late 2014. After mentioning it to the people at Local Lion, we determined that this shift coincides with an intensive remodel that occured around that time. I guess it paid off!

Now, ultimately I'd like to make a model that predicts how many yeast donuts we should make on a given day considering a number of external factors (weather, student presence, etc.). So let's begin by adding some additional data to the dataframe! 

Let's begin by making a column for `month` and a column for `season`!
```{r}
donuts_ms <- donuts %>%
  mutate(Year = ordered(as.factor(paste(year(Date)))),
         Month = ordered(as.factor(paste(month(Date), year(Date), sep = "/"))),
         Season = as.factor(ifelse(Month %in% c("8/2013", "9/2013", "10/2013", "8/2014", "9/2014", "10/2014", "8/2015","9/2015", "10/2015", "8/2016", "9/2016", "10/2016", "8/2017", "9/2017", "10/2017", "8/2018", "9/2018", "10/2018"), "Fall",
                  ifelse(Month %in% c("11/2013", "12/2013", "1/2013", "2/2013","11/2014", "12/2014", "1/2014", "2/2014", "11/2015", "12/2015", "1/2015", "2/2015", "11/2016", "12/2016", "1/2016", "2/2016", "11/2017", "12/2017", "1/2017", "2/2017", "11/2018", "12/2018", "1/2018", "2/2018"), "Winter",
                  ifelse(Month %in% c("3/2013", "4/2013", "3/2014", "4/2014 ", "3/2015", "4/2015", "3/2016", "4/2016", "3/2017", "4/2017", "3/2018", "4/2018"), "Spring", "Summer")))))
```


Boone, NC can be accurately described as a "college town". The student population matches (or possibly surpasses) the resident population. Therefore, I've always assumed that sales lag during the summer, when half the town is gone. Let's do some quick data visualization to see if this is the case!  
```{r, echo = FALSE}
donuts_ms %>% 
  ggplot(aes(Date, Daily, color = Season)) +
  geom_point() +
  labs(x = "Donut Sales per Season")
```
  
Wow! Much to my surprise, donut sales in the summer don't appear to lag at all, one could even make a tentative claim that they sell slightly better than in the spring. I suppose that the tourist influx mitigates any dip in business from student absence.

```{r}
donuts_ms %>% 
  ggplot(aes(Date, Daily)) +
  geom_boxplot() +
  facet_wrap(~ Season)
```
  
There doesn't appear to be any significant difference in donut sales based on season.

Let's peep the *number* of donuts sold by season. 
```{r, echo = FALSE}
donuts_ms %>% 
  group_by(Season) %>% 
  summarize(Total = sum(Daily))
```
Spring appears to be a slump season, but I readily attribute that to the way I coded `seasons`; "Spring" is classified as only two months - March and April.


```{r, echo = FALSE, eval = FALSE}
install.packages("devtools")
library("devtools")
install_github("Ram-N/weatherData")
library(weatherData)
```

Have we sold more donuts or coffee?
```{r}
s13 <- read.csv("./s13.csv")
s14 <- read.csv("./s14.csv")
s15 <- read.csv("./s15.csv")
s16 <- read.csv("./s16.csv")
s17 <- read.csv("./s17.csv")
s18 <- read.csv("./s18.csv")
```

```{r}
glimpse(s18)
```
```{r}
s18 <- s18 %>% 
  select(Item.Name, Items.Sold, Net.Sales)
s18$Item.Name <- as.character(s18$Item.Name)
s18$Net.Sales <- as.numeric(gsub('[$,]', '', s18$Net.Sales))
glimpse(s18)
```

```{r}
s18 <- s18[-c(1,2,4:6,8:11,33,37,39,47,51,52,60,65,66,68,70,71,73:76,79),]
s18$Item.Name
```


```{r, echo = FALSE, eval = FALSE}
s13 <- s13[-c(1:3,5:8,11,15,16,24,28,41,43,44,61,65,75,76,78:82,86),]
s13$Item.Name
```

```{r}
s18$Desserts <- as.integer(c(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,1))
glimpse(s18)
```

```{r}
s18 %>% 
filter(Desserts == 1) %>% 
summarize("Total Sold" = sum(Items.Sold),
          "Net Sales" = sum(Net.Sales))
  
```

```{r}
s18 %>% 
filter(Desserts == 0) %>% 
summarize("Total Sold" = sum(Items.Sold),
          "Net Sales" = sum(Net.Sales))
```


```{r, echo = FALSE, eval = FALSE}
ss18 <- s18 %>% 
  select(Item.Name, Items.Sold, Net.Sales)

ss17 <- s17 %>% 
  select(Item.Name, Items.Sold, Net.Sales)

sales <- ss18 %>% 
  bind_rows(ss17)
```
```{r, echo = FALSE, eval = FALSE}
anti_join(s18, s17, by = "Item.Name")
```


`data_frame()`
```{r, echo = FALSE, eval = FALSE}
dsales <- data_frame(Items = s18$Item.Name, Sold = (s18$Items.Sold + s17$Items.Sold))
```

